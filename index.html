
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compteur Bitcoin France</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Arial:wght@400;700&display=swap');
        body { 
            font-family: 'Arial', sans-serif; 
            background: #000; 
            color: #fff; 
            margin: 0; 
            padding: 0; 
            overflow: auto;
        }
        .container { display: flex; min-height: 100vh; }
        .left { 
            flex: 1; 
            padding: 40px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            background: #000; 
        }
        .right { 
            flex: 1; 
            padding: 40px; 
            background: #111; 
        }
        h1 { 
            font-size: 2.5em; 
            color: #F7931A; 
            margin-bottom: 20px; 
            text-align: center;
        }
        p { color: #ccc; text-align: center; margin-bottom: 40px; }
        .share-select { 
            font-size: 1.2em; 
            color: #F7931A; 
            background: rgba(247, 147, 26, 0.1); 
            border: 2px solid #F7931A; 
            border-radius: 8px; 
            padding: 10px; 
            margin-bottom: 20px; 
            text-align: center;
        }
        .counter { 
            font-size: 2.5em; 
            font-weight: 700; 
            margin: 20px 0; 
            padding: 20px; 
            background: rgba(247, 147, 26, 0.1); 
            border: 2px solid #F7931A; 
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(247, 147, 26, 0.3); 
            color: #fff;
            transition: all 0.3s ease;
        }
        .label { 
            font-size: 1.2em; 
            color: #F7931A; 
            margin-bottom: 10px; 
            text-align: center;
        }
        h2 { color: #F7931A; text-align: center; margin-bottom: 20px; }
        #powerLawChart { 
            max-height: 500px; 
            background: #000; 
            border-radius: 8px; 
            border: 1px solid #F7931A; 
            margin-bottom: 20px;
        }
        .additional-text { 
            color: #ccc; 
            font-size: 0.9em; 
            text-align: left; 
            line-height: 1.6;
        }
        .additional-text ul { 
            list-style-type: none; 
            padding-left: 0; 
        }
        .additional-text li { 
            margin-bottom: 10px; 
            padding-left: 20px; 
            position: relative; 
        }
        .additional-text li::before { 
            content: "•"; 
            color: #F7931A; 
            font-weight: bold; 
            position: absolute; 
            left: 0; 
        }
        a:link {
        color: orange;
        background-color: transparent;
        text-decoration: none;
        }

        a:visited {
        color: orange;
        background-color: transparent;
        text-decoration: none;
        }

        a:hover {
        color: red;
        background-color: transparent;
        text-decoration: underline;
        }

        a:active {
        color: orange;
        background-color: transparent;
        text-decoration: underline;
        }
        .updating { color: #ccc; font-size: 0.9em; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="left">
            <h1>Compteur Bitcoin France</h1>
            <p>Coût d'opportunité si la France avait miné X% (sélectionnable ci-dessous) de la puissance globale de hashage depuis 2018. Mises à jour en temps réel toutes les 10 minutes.</p>
            
            <select id="shareSelect" class="share-select">
                <option value="1">1%</option>
                <option value="2">2%</option>
                <option value="5">5%</option>
                <option value="10" selected>10%</option>
                <option value="15">15%</option>
            </select>
            
            <div class="label">MW/Jour Nécessaires</div>
            <div class="counter" id="mwhCounter">0</div>

            <div class="label">Total Manqués (€)</div>
            <div class="counter" id="totalEurosCounter">0</div>
            
            <div class="label">BTC Manqués</div>
            <div class="counter" id="btcCounter">0</div>
            
            <div class="label">Prix BTC Actuel (€)</div>
            <div class="counter" id="priceCounter">0</div>
            
            <div class="label">Blocs Manqués</div>
            <div class="counter" id="blocksCounter">0</div>
            
            
            
            <div class="updating" id="updateText">Mise à jour en temps réel via API.</div>
        </div>
        
        <div class="right">
            <h2>Prix Historique BTC (EUR) & Loi de Puissance (exposant 5.8)</h2>
            <canvas id="powerLawChart"></canvas>
            <div class="additional-text">
                <ul>
                    <li>Ce manque à gagner n'inclut pas les potentiels retombées économiques de réindustrialiser la France avec une nouvelle industrie novatrice.</li>
                    <li>La création d'emplois dans des régions rurales et là où les containers de minage peuvent s'implémenter.</li>
                    <li>La potentielle mise en place de circularité en injectant une partie des profits dans les collectivités locales.</li>
                    <li>Pour maximiser l'utilité du minage de Bitcoin dans la société : les profits du minage pourraient servir au bien-être des populations, au développement des énergies renouvelables, à l'agroécologie et à aider à la transition bas-carbone des pays du sud par exemple.</li>
                    <li>Ce script calcule le potentiel manqué en milliards d'euros. Il suppose que la France aurait pu dédier une part fixe (1,2,5,10 ou 15%) de la puissance de hachage globale du Bitcoin depuis janvier 2018 (une hypothèse réaliste avec différents scénarios et basée sur une estimation d'électricité consommé globalement du Bitcoin ~500 TWh cumulés sur la période). Il fetch les données en temps réel (hauteur de bloc actuelle et prix du BTC en EUR) via des API gratuites. Le total est le nombre de BTC minés multiplié par le prix actuel, converti en milliards d'EUR.</li>
                    <li>Récupération en temps réel : Toutes les 10 minutes (600 000 ms), le JS fetch les données via les API (hauteur de bloc via Blockstream et prix via CoinGecko). Les API sont gratuites et CORS-compatibles.</li>
                    <li>Calculs dynamiques : J'ai intégré une fonction JS calculateMinedBtc qui miroite le calcul Python pour déterminer les BTC minés cumulés (en tenant compte des halvings). Le total gaspillage est recalculé comme (BTC # manqués totaux × prix actuel), et les compteurs s'animent vers les nouvelles valeurs.</li>
                    <li><a href="https://colab.research.google.com/drive/1OC5ePgAxMX47JP14uQVTpBktjd2kZq6u?usp=sharing">Ceci est une simulation</a> qui peut donner une idée de "l'ordre de grandeur" total sans pour autant prendre en compte CAPEX et autres considérations techniques et implémentations fines.</li>
                    <li><a href="https://b1m.io/">Bitcoin suit une loi de puissance</a> et le rendement futur pourrait être projeté avec un écart type d'erreur.</li>
                    <li>En apprendre plus sur Bitcoin avec <a href="https://tinyurl.com/viebitcoin">un article scientifique qui lui est dédié</a>.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Fonction pour calculer les BTC minés (miroir du Python)
        function calculateMinedBtc(currentBlock) {
            let totalBtc = 0.0;
            const startBlock = 499500;
            
            // Période 1 : ~499500 à 630000 (12.5 BTC)
            const halving1End = 630000;
            let blocks1 = Math.max(0, Math.min(halving1End, currentBlock) - Math.max(startBlock, 499500));
            totalBtc += blocks1 * 12.5;
            
            // Période 2 : 630000 à 840000 (6.25 BTC)
            const halving2Start = 630000;
            const halving2End = 840000;
            let blocks2Start = Math.max(startBlock, halving2Start);
            let blocks2End = Math.min(halving2End, currentBlock);
            let blocks2 = Math.max(0, blocks2End - blocks2Start);
            totalBtc += blocks2 * 6.25;
            
            // Période 3 : 840000+ (3.125 BTC)
            const halving3Start = 840000;
            let blocks3Start = Math.max(startBlock, halving3Start);
            let blocks3End = currentBlock;
            let blocks3 = Math.max(0, blocks3End - blocks3Start);
            totalBtc += blocks3 * 3.125;
            
            return totalBtc;
        }

        // Animation fluide des compteurs
        function animateCounter(id, target, duration = 2000, suffix = '') {
            const counter = document.getElementById(id);
            const start = parseFloat(counter.textContent.replace(/,/g, '').replace(/[^0-9.-]/g, '')) || 0;
            const range = target - start;
            const increment = range / (duration / 16);
            let current = start;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                if (id === 'totalEurosCounter' || id === 'btcCounter' || id === 'blocksCounter' || id === 'mwhCounter') {
                    counter.textContent = Math.floor(current).toLocaleString() + suffix;
                } else {
                    counter.textContent = current.toFixed(2).toLocaleString() + suffix;
                }
            }, 16);
        }

        // Fonction pour mettre à jour tous les compteurs avec le share actuel
        function updateAllCounters(newHeight, newPrice, newBlocks, totalMw) {
            const share = currentShare / 100;
            const newTotalMined = calculateMinedBtc(newHeight);
            const newTotalBtc = newTotalMined * share;
            const newTotalEuros = Math.floor(newTotalBtc * newPrice);
            const newMw = totalMw * share;
            
            animateCounter('totalEurosCounter', newTotalEuros, 1000, ' €');
            animateCounter('btcCounter', newTotalBtc, 1000, ' BTC');
            animateCounter('priceCounter', newPrice, 1000, ' €');
            animateCounter('blocksCounter', newBlocks, 1000, '');
            animateCounter('mwhCounter', newMw, 1000, ' MW');
        }

        // Données embeddées initiales
        const initialTotalEuros = 31010503080;
        const initialBtc = 318477.8125;
        const initialPrice = 97371;
        const initialBlocks = 417629;
        const histData = [{"x": 2018.0, "y": 10000}, {"x": 2025.0, "y": 97000}];
        const powerData = [{"x": 2025.7392197125257, "y": 97371.0}, {"x": 2025.8213552361397, "y": 100174.94473391569}, {"x": 2025.9034907597536, "y": 103045.38272672652}, {"x": 2025.9856262833675, "y": 105983.55618484096}, {"x": 2026.0677618069815, "y": 108990.72433078104}, {"x": 2026.1498973305954, "y": 112068.16355229953}, {"x": 2026.2320328542094, "y": 115217.16755207517}, {"x": 2026.3141683778233, "y": 118439.04749798523}, {"x": 2026.3963039014375, "y": 121735.13217395505}, {"x": 2026.4784394250514, "y": 125106.76813138378}, {"x": 2026.5605749486654, "y": 128555.319841146}, {"x": 2026.6427104722793, "y": 132082.1698461684}, {"x": 2026.7248459958932, "y": 135688.71891458126}, {"x": 2026.8069815195072, "y": 139376.38619344408}, {"x": 2026.8891170431211, "y": 143146.60936304482}, {"x": 2026.971252566735, "y": 147000.844791772}, {"x": 2027.053388090349, "y": 150940.56769155964}, {"x": 2027.135523613963, "y": 154967.27227390415}, {"x": 2027.217659137577, "y": 159082.4719064524}, {"x": 2027.299794661191, "y": 163287.69927016133}, {"x": 2027.381930184805, "y": 167584.5065170274}, {"x": 2027.464065708419, "y": 171974.4654283864}, {"x": 2027.546201232033, "y": 176459.16757378264}, {"x": 2027.6283367556468, "y": 181040.22447040674}, {"x": 2027.7104722792608, "y": 185719.2677431023}, {"x": 2027.7926078028747, "y": 190497.94928494006}, {"x": 2027.8747433264887, "y": 195377.94141835964}, {"x": 2027.9568788501026, "y": 200360.9370568783}, {"x": 2028.0390143737166, "y": 205448.64986736578}, {"x": 2028.1211498973305, "y": 210642.8144328855}, {"x": 2028.2032854209447, "y": 215945.1864161007}, {"x": 2028.2854209445586, "y": 221357.54272324586}, {"x": 2028.3675564681726, "y": 226881.68166866244}, {"x": 2028.4496919917865, "y": 232519.42313989854}, {"x": 2028.5318275154004, "y": 238272.60876337223}, {"x": 2028.6139630390144, "y": 244143.10207059752}, {"x": 2028.6960985626283, "y": 250132.7886649734}, {"x": 2028.7782340862423, "y": 256243.57638913428}, {"x": 2028.8603696098562, "y": 262477.39549286256}, {"x": 2028.9425051334701, "y": 268836.198801562}, {"x": 2029.024640657084, "y": 275321.96188529197}, {"x": 2029.1067761806983, "y": 281936.68322836154}, {"x": 2029.1889117043122, "y": 288682.38439948374}, {"x": 2029.2710472279261, "y": 295561.11022248847}, {"x": 2029.35318275154, "y": 302574.92894759506}, {"x": 2029.435318275154, "y": 309725.9324232423}, {"x": 2029.517453798768, "y": 317016.23626847676}, {"x": 2029.599589322382, "y": 324447.9800458988}, {"x": 2029.6817248459959, "y": 332023.3274351651}, {"x": 2029.7638603696098, "y": 339744.46640704805}, {"x": 2029.8459958932237, "y": 347613.60939805105}, {"x": 2029.9281314168377, "y": 355632.99348557956}, {"x": 2030.0102669404519, "y": 363804.8805636675}, {"x": 2030.0924024640658, "y": 372131.55751925823}, {"x": 2030.1745379876797, "y": 380615.33640903974}, {"x": 2030.2566735112937, "y": 389258.55463683436}, {"x": 2030.3388090349076, "y": 398063.575131541}, {"x": 2030.4209445585216, "y": 407032.78652563156}, {"x": 2030.5030800821355, "y": 416168.603334199}, {"x": 2030.5852156057495, "y": 425473.4661345578}, {"x": 2030.6673511293634, "y": 434949.8417463971}];
        const initialTotalMw = 29718.734519744517;
        const startBlock = 499500;
        const initialCurrentBlock = 917129;

        let currentShare = 10;
        let lastHeight = initialCurrentBlock;
        let lastPrice = initialPrice;
        let lastTotalMw = initialTotalMw;

        // Événement pour le dropdown
        document.getElementById('shareSelect').onchange = function(e) {
            currentShare = parseInt(e.target.value);
            // Mise à jour immédiate avec les dernières données connues
            if (lastHeight && lastPrice) {
                fetch('https://api.blockchain.info/charts/hash-rate?format=json&cors=true')
                .then(r => r.json())
                .then(hashData => {
                    const hr_ths = hashData.values[hashData.values.length - 1].y;
                    const eff = 30; // J/TH moyenne
                    const total_power_w = hr_ths * eff;
                    const total_mw = total_power_w / 1000000;
                    updateAllCounters(lastHeight, lastPrice, lastHeight - startBlock, total_mw);
                    lastTotalMw = total_mw;
                })
                .catch(() => {
                    // Fallback avec valeur initiale
                    updateAllCounters(lastHeight, lastPrice, lastHeight - startBlock, initialTotalMw);
                });
            }
        };

        // Fonction de mise à jour en temps réel
        async function updateData() {
            try {
                const heightRes = await fetch('https://blockstream.info/api/blocks/tip/height');
                const heightText = await heightRes.text();
                const newHeight = parseInt(heightText);
                
                const priceRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=eur');
                const priceData = await priceRes.json();
                const newPrice = priceData.bitcoin.eur;
                
                // Fetch hash rate pour MW
                const hrRes = await fetch('https://api.blockchain.info/charts/hash-rate?format=json&cors=true');
                const hashData = await hrRes.json();
                const hr_ths = hashData.values[hashData.values.length - 1].y;
                const eff = 30; // J/TH moyenne réseau
                const total_power_w = hr_ths * eff;
                const total_mw = total_power_w / 1000000;
                
                const newBlocks = newHeight - startBlock;
                
                // Mise à jour avec share actuel
                updateAllCounters(newHeight, newPrice, newBlocks, total_mw);
                
                // Mise à jour du timestamp
                document.getElementById('updateText').textContent = `Dernière mise à jour: ${new Date().toLocaleString('fr-FR')}`;
                
                lastHeight = newHeight;
                lastPrice = newPrice;
                lastTotalMw = total_mw;
            } catch (e) {
                console.error('Erreur lors de la mise à jour:', e);
                // Fallback
                updateAllCounters(lastHeight, lastPrice, lastHeight - startBlock, lastTotalMw);
            }
        }

        // Initialisation
        window.onload = () => {
            // Animation initiale avec share=10
            const initialShare = 0.10;
            const initialMw = initialTotalMw * initialShare;
            
            document.getElementById('totalEurosCounter').textContent = '0';
            document.getElementById('btcCounter').textContent = '0';
            document.getElementById('priceCounter').textContent = '0';
            document.getElementById('blocksCounter').textContent = '0';
            document.getElementById('mwhCounter').textContent = '0';
            
            animateCounter('totalEurosCounter', initialTotalEuros, 3000, ' €');
            animateCounter('btcCounter', initialBtc, 3000, ' BTC');
            animateCounter('priceCounter', initialPrice, 2000, ' €');
            animateCounter('blocksCounter', initialBlocks, 2000, '');
            animateCounter('mwhCounter', initialMw, 2000, ' MW');
            
            // Graphique Chart.js avec historique et loi de puissance
            const ctx = document.getElementById('powerLawChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Prix Historique (EUR)',
                            data: histData,
                            borderColor: '#F7931A',
                            backgroundColor: 'rgba(247, 147, 26, 0.1)',
                            tension: 0.1,
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'Loi de Puissance (exposant 5.8)',
                            data: powerData,
                            borderColor: '#FF6B35',
                            backgroundColor: 'transparent',
                            tension: 0.1,
                            pointRadius: 0,
                            fill: false,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            title: { display: true, text: 'Année', color: '#fff' }
                        },
                        y: {
                            type: 'linear',
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            title: { display: true, text: 'Prix BTC (EUR)', color: '#fff' },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#fff' } }
                    }
                }
            });
            
            // Première mise à jour immédiate pour synchroniser
            setTimeout(updateData, 1000);
            
            // Mises à jour toutes les minutes
            setInterval(updateData, 600000);
        };
    </script>
</body>
</html>
    